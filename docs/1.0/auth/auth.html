<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Authentication setup | Laravel Restify</title>
    <meta name="description" content="A package to start the REST API">
    <link rel="manifest" href="/laravel-restify/manifest.json">
  <link rel="icon" href="/laravel-restify/icon.png">
    <meta name="docsearch:version" content="1.0.0">
    <link rel="preload" href="/laravel-restify/assets/css/0.styles.e17ee226.css" as="style"><link rel="preload" href="/laravel-restify/assets/js/app.9f7e32d5.js" as="script"><link rel="preload" href="/laravel-restify/assets/js/2.c48f6ac5.js" as="script"><link rel="preload" href="/laravel-restify/assets/js/7.eff9fbd6.js" as="script"><link rel="prefetch" href="/laravel-restify/assets/js/10.3f3f6739.js"><link rel="prefetch" href="/laravel-restify/assets/js/11.06c45be6.js"><link rel="prefetch" href="/laravel-restify/assets/js/12.840b05f7.js"><link rel="prefetch" href="/laravel-restify/assets/js/13.18cf7203.js"><link rel="prefetch" href="/laravel-restify/assets/js/14.5b30f001.js"><link rel="prefetch" href="/laravel-restify/assets/js/15.4b638093.js"><link rel="prefetch" href="/laravel-restify/assets/js/16.3ba1d8ca.js"><link rel="prefetch" href="/laravel-restify/assets/js/17.6d408da1.js"><link rel="prefetch" href="/laravel-restify/assets/js/18.0e7ebcd1.js"><link rel="prefetch" href="/laravel-restify/assets/js/19.13d7564b.js"><link rel="prefetch" href="/laravel-restify/assets/js/20.9ac51fba.js"><link rel="prefetch" href="/laravel-restify/assets/js/21.2d500876.js"><link rel="prefetch" href="/laravel-restify/assets/js/22.af8ea074.js"><link rel="prefetch" href="/laravel-restify/assets/js/23.e87aab82.js"><link rel="prefetch" href="/laravel-restify/assets/js/3.3bbe9845.js"><link rel="prefetch" href="/laravel-restify/assets/js/4.fec85292.js"><link rel="prefetch" href="/laravel-restify/assets/js/5.5adab4f9.js"><link rel="prefetch" href="/laravel-restify/assets/js/6.ab19288b.js"><link rel="prefetch" href="/laravel-restify/assets/js/8.83db03f1.js"><link rel="prefetch" href="/laravel-restify/assets/js/9.fb2371b9.js">
    <link rel="stylesheet" href="/laravel-restify/assets/css/0.styles.e17ee226.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/laravel-restify/" class="home-link router-link-active"><img src="/laravel-restify/assets/img/icon.png" alt="Laravel Restify" class="logo"> <span class="site-name can-hide">Laravel Restify</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/laravel-restify/docs/2.0/" class="nav-link">Docs</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Version" class="dropdown-title"><span class="title">Version</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/laravel-restify/docs/1.0/" class="nav-link router-link-active">1.0</a></li><li class="dropdown-item"><!----> <a href="/laravel-restify/docs/2.0/" class="nav-link">2.0</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/binaryk/laravel-restify" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Git
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://binarcode.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  About us
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/laravel-restify/docs/2.0/" class="nav-link">Docs</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Version" class="dropdown-title"><span class="title">Version</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/laravel-restify/docs/1.0/" class="nav-link router-link-active">1.0</a></li><li class="dropdown-item"><!----> <a href="/laravel-restify/docs/2.0/" class="nav-link">2.0</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/binaryk/laravel-restify" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Git
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://binarcode.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  About us
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Quick Start</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/laravel-restify/docs/1.0/quickstart.html" class="sidebar-link">Installation 1.0</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/quickstart.html#requirements" class="sidebar-link">Requirements</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/quickstart.html#installing-laravel-restify" class="sidebar-link">Installing Laravel Restify</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/quickstart.html#setup-laravel-restify" class="sidebar-link">Setup Laravel Restify</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/quickstart.html#quick-start" class="sidebar-link">Quick start</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/quickstart.html#generate-repository" class="sidebar-link">Generate repository</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/quickstart.html#generate-policy" class="sidebar-link">Generate policy</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Repository</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/laravel-restify/docs/1.0/repository-pattern/repository-pattern.html" class="sidebar-link">Repository</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/repository-pattern/repository-pattern.html#introduction" class="sidebar-link">Introduction</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/repository-pattern/repository-pattern.html#quick-start" class="sidebar-link">Quick start</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/repository-pattern/repository-pattern.html#defining-repositories" class="sidebar-link">Defining Repositories</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/repository-pattern/repository-pattern.html#actions-handled-by-the-repository" class="sidebar-link">Actions handled by the Repository</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/repository-pattern/repository-pattern.html#fields" class="sidebar-link">Fields</a></li></ul></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/repository-pattern/repository-pattern.html#dependency-injection" class="sidebar-link">Dependency injection</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/repository-pattern/repository-pattern.html#restify-repository-conventions" class="sidebar-link">Restify Repository Conventions</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/repository-pattern/repository-pattern.html#model-name" class="sidebar-link">Model name</a></li></ul></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/repository-pattern/repository-pattern.html#crud-methods-overriding" class="sidebar-link">CRUD Methods overriding</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/repository-pattern/repository-pattern.html#index" class="sidebar-link">index</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/repository-pattern/repository-pattern.html#show" class="sidebar-link">show</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/repository-pattern/repository-pattern.html#store" class="sidebar-link">store</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/repository-pattern/repository-pattern.html#update" class="sidebar-link">update</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/repository-pattern/repository-pattern.html#destroy" class="sidebar-link">destroy</a></li></ul></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/repository-pattern/repository-pattern.html#transformation-layer" class="sidebar-link">Transformation layer</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/repository-pattern/repository-pattern.html#custom-routes" class="sidebar-link">Custom routes</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/repository-pattern/repository-pattern.html#route-prefix" class="sidebar-link">Route prefix</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/repository-pattern/repository-pattern.html#route-middleware" class="sidebar-link">Route middleware</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/repository-pattern/repository-pattern.html#route-namespace" class="sidebar-link">Route Namespace</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Field</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/laravel-restify/docs/1.0/repository-pattern/field.html" class="sidebar-link">Field</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/repository-pattern/field.html#attaching-rules" class="sidebar-link">Attaching rules</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/repository-pattern/field.html#storing-rules" class="sidebar-link">Storing Rules</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/repository-pattern/field.html#update-rules" class="sidebar-link">Update Rules</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/repository-pattern/field.html#fill-callback" class="sidebar-link">Fill callback</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/repository-pattern/field.html#store-callback" class="sidebar-link">Store callback</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Rest Controller</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/laravel-restify/docs/1.0/rest-methods/rest-methods.html" class="sidebar-link">/docs/1.0/rest-methods/rest-methods.html</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/rest-methods/rest-methods.html#introduction" class="sidebar-link">Introduction</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/rest-methods/rest-methods.html#restify-response-quickstart" class="sidebar-link">Restify Response Quickstart</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/rest-methods/rest-methods.html#defining-the-route" class="sidebar-link">Defining The Route</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/rest-methods/rest-methods.html#creating-the-controller" class="sidebar-link">Creating The Controller</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/rest-methods/rest-methods.html#writing-the-api-response-logic" class="sidebar-link">Writing The API Response Logic</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/rest-methods/rest-methods.html#receiving-api-response" class="sidebar-link">Receiving API Response</a></li></ul></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/rest-methods/rest-methods.html#response-factory" class="sidebar-link">Response factory</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/rest-methods/rest-methods.html#displaying-response-errors" class="sidebar-link">Displaying Response Errors</a></li></ul></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/rest-methods/rest-methods.html#custom-header" class="sidebar-link">Custom Header</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/rest-methods/rest-methods.html#optional-attributes" class="sidebar-link">Optional Attributes</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/rest-methods/rest-methods.html#hiding-default-attribute" class="sidebar-link">Hiding Default Attribute</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/rest-methods/rest-methods.html#rest-response-methods" class="sidebar-link">Rest Response Methods</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/rest-methods/rest-methods.html#data-attaching" class="sidebar-link">Data attaching</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/rest-methods/rest-methods.html#headers-setup" class="sidebar-link">Headers setup</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/rest-methods/rest-methods.html#meta-information" class="sidebar-link">Meta information</a></li></ul></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/rest-methods/rest-methods.html#response-code-modifiers" class="sidebar-link">Response code modifiers</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/rest-methods/rest-methods.html#auth-401" class="sidebar-link">Auth 401</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/rest-methods/rest-methods.html#refresh-103" class="sidebar-link">Refresh 103</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/rest-methods/rest-methods.html#created-201" class="sidebar-link">Created 201</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/rest-methods/rest-methods.html#deleted-no-content-204" class="sidebar-link">Deleted (No Content) 204</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/rest-methods/rest-methods.html#invalid-400" class="sidebar-link">Invalid 400</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/rest-methods/rest-methods.html#unauthorized-401" class="sidebar-link">Unauthorized 401</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/rest-methods/rest-methods.html#forbidden-403" class="sidebar-link">Forbidden 403</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/rest-methods/rest-methods.html#missing-404" class="sidebar-link">Missing 404</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/rest-methods/rest-methods.html#success" class="sidebar-link">success</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/rest-methods/rest-methods.html#unavailable-503" class="sidebar-link">Unavailable 503</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/rest-methods/rest-methods.html#throttle-429" class="sidebar-link">Throttle 429</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/rest-methods/rest-methods.html#debug-methods" class="sidebar-link">Debug methods</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/rest-methods/rest-methods.html#line" class="sidebar-link">line</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/rest-methods/rest-methods.html#file" class="sidebar-link">file</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/rest-methods/rest-methods.html#stack" class="sidebar-link">stack</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/rest-methods/rest-methods.html#errors-methods" class="sidebar-link">Errors methods</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/rest-methods/rest-methods.html#errors" class="sidebar-link">errors</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/rest-methods/rest-methods.html#adderror" class="sidebar-link">addError</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Filtering</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/laravel-restify/docs/1.0/search/search.html" class="sidebar-link">Filtering entities</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/search/search.html#search" class="sidebar-link">Search</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/search/search.html#match" class="sidebar-link">Match</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/search/search.html#sort" class="sidebar-link">Sort</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/search/search.html#eager-loading-aka-withs" class="sidebar-link">Eager loading - aka withs</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Auth service</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/laravel-restify/docs/1.0/auth/auth.html" class="active sidebar-link">Authentication setup</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/auth/auth.html#prerequisites" class="sidebar-link">Prerequisites</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/auth/auth.html#register-users" class="sidebar-link">Register users</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/auth/auth.html#verifying-users-optional" class="sidebar-link">Verifying users (optional)</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/auth/auth.html#login-users-issue-token" class="sidebar-link">Login users (issue token)</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/auth/auth.html#forgot-password" class="sidebar-link">Forgot password</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/auth/auth.html#reset-password" class="sidebar-link">Reset password</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Error handler</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/laravel-restify/docs/1.0/exception-handler/exception-handler.html" class="sidebar-link">Restify Exception Handler</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/exception-handler/exception-handler.html#disable-restify-exception-handler" class="sidebar-link">Disable Restify exception handler</a></li><li class="sidebar-sub-header"><a href="/laravel-restify/docs/1.0/exception-handler/exception-handler.html#intercept-exceptions" class="sidebar-link">Intercept exceptions</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="authentication-setup"><a href="#authentication-setup" class="header-anchor">#</a> Authentication setup</h1> <p>Laravel Restify has the authentication implemented with Passport, so you can use it out of the box.
You'll finally enjoy the auth setup (<code>register</code>, <code>login</code>, <code>forgot</code> and <code>reset password</code>).</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>First make sure you have installed and configured the Laravel Passport properly.
This can be done easily by using the follow Restify command:</p> <p><code>php artisan restify:check-passport</code></p> <p>This command will become with suggestions if anything is setup wrong.</p></div> <h2 id="prerequisites"><a href="#prerequisites" class="header-anchor">#</a> Prerequisites</h2> <ul><li>When using the Restify authentication service, you will need to migrate the <code>users</code> and <code>password_resets</code> table (these 2 migrations are by default in a fresh laravel app, however you may modify the users table as you prefer)</li> <li>Make sure your authenticatable entity (usually <code>User</code>) implements: <code>Illuminate\Contracts\Auth\Authenticatable</code></li> <li>Make sure your authenticatable implements the <code>Binaryk\LaravelRestify\Contracts\Passportable</code> interface.</li> <li>Check if <code>restify:check-passport</code> passes with success.</li></ul> <h2 id="register-users"><a href="#register-users" class="header-anchor">#</a> Register users</h2> <ul><li>Define a register route to an action controller:</li></ul> <div class="language-php extra-class"><pre class="language-php"><code>Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'register'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'AuthController@register'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>Inject the AuthService into your controller and call the register method:</li></ul> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Request</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Response</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Binaryk<span class="token punctuation">\</span>LaravelRestify<span class="token punctuation">\</span>Services<span class="token punctuation">\</span>AuthService</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">AuthController</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
     * @var AuthService
     */</span>
    <span class="token keyword">protected</span> <span class="token variable">$authService</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span>AuthService <span class="token variable">$authService</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">authService</span> <span class="token operator">=</span> <span class="token variable">$authService</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/**
     * This will validate the input, 
     * will register the user and return it back to the api
     * 
     * @param Request $request
     * @return JsonResponse
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">register</span><span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">authService</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> Response<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'data'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$user</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">201</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><ul><li>Validating input</li></ul> <p>Restify will automatically validate the data send from the request to the <code>register</code> method.</p> <p>Used validation FormRequest is: <code>Binaryk\LaravelRestify\Http\Requests\RestifyRegisterRequest</code></p> <p>However if you want to validate the registration payload yourself you can disable the built in validation by nullifying <code>$registerFormRequest</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">register</span><span class="token punctuation">(</span>UserRegisterRequest <span class="token variable">$request</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    AuthService<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token variable">$registerFormRequest</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>
    
    <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">authService</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">only</span><span class="token punctuation">(</span><span class="token function">array_keys</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">rules</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> Response<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'data'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$user</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">201</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Or you could simply override the <code>$registerFormRequest</code> with custom FormRequest:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">register</span><span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    AuthService<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token variable">$registerFormRequest</span> <span class="token operator">=</span> UserRegisterRequest<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">;</span>
    
    <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">authService</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> Response<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'data'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$user</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">201</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>Exceptions</li></ul> <p>If something went wrong inside the register method, the AuthService will thrown few suggestive exceptions you can handle in the controller:</p> <blockquote><p><code>Binaryk\LaravelRestify\Exceptions\PassportUserException</code> - Make sure your authenticatable entity (usually <code>User</code>) is implementing the <code>Binaryk\LaravelRestify\Contracts\Passportable</code> interface.</p></blockquote> <blockquote><p><code>\Binaryk\LaravelRestify\Exceptions\AuthenticatableUserException</code> - Make sure your authenticatable entity (usually <code>User</code>) is implementing the <code>Illuminate\Contracts\Auth\Authenticatable</code> interface.</p></blockquote> <blockquote><p><code>\Binaryk\LaravelRestify\Exceptions\Eloquent\EntityNotFoundException</code> - Class (usually <code>App\User</code>) defined in the configuration <code>auth.providers.users.model</code> could not been instantiated (may be abstract or missing at all)</p></blockquote> <ul><li>After successfully registering user, an <code>Illuminate\Auth\Events\Registered</code> event will be dispatched.</li></ul> <h2 id="verifying-users-optional"><a href="#verifying-users-optional" class="header-anchor">#</a> Verifying users (optional)</h2> <p>This is an optional feature, but sometimes we may want users to validation the registered email.</p> <ul><li>Prerequisites</li></ul> <p>Make sure <code>User</code> model implementing the <code>Illuminate\Contracts\Auth\MustVerifyEmail</code> contract.</p> <p>The <code>MustVerifyEmail</code> contract will wait for a <code>sendEmailVerificationNotification</code> method definition.</p> <p>This method could look like this:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// app/User.php</span>

<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">sendEmailVerificationNotification</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">VerifyEmail</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The <code>VerifyEmail</code> should send the notification email to the user. This email should include two required data:</p> <blockquote><p>the sha1 hash of the user email</p></blockquote> <blockquote><p>user id</p></blockquote> <p>so your frontend application could easily make a verify call to the API with this data.</p> <p>Example of notification:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Notifications<span class="token punctuation">\</span>Messages<span class="token punctuation">\</span>MailMessage</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Notifications<span class="token punctuation">\</span>Notification</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Carbon</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Config</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Lang</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>URL</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">VerifyEmail</span> <span class="token keyword">extends</span> <span class="token class-name">Notification</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
     * Get the notification's channels.
     *
     * @param mixed $notifiable
     * @return array|string
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">via</span><span class="token punctuation">(</span><span class="token variable">$notifiable</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'mail'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Build the mail representation of the notification.
     *
     * @param mixed $notifiable
     * @return \Illuminate\Notifications\Messages\MailMessage
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">toMail</span><span class="token punctuation">(</span><span class="token variable">$notifiable</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$verificationUrl</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">verificationUrl</span><span class="token punctuation">(</span><span class="token variable">$notifiable</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MailMessage</span><span class="token punctuation">)</span>
            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">subject</span><span class="token punctuation">(</span>Lang<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Verify Email Address'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">line</span><span class="token punctuation">(</span>Lang<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Please click the button below to verify your email address.'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">action</span><span class="token punctuation">(</span>Lang<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Verify Email Address'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$verificationUrl</span><span class="token punctuation">)</span>
            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">line</span><span class="token punctuation">(</span>Lang<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'If you did not create an account, no further action is required.'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Get the verification URL for the given notifiable.
     *
     * @param mixed $notifiable // the User entity in our case
     * @return string
     */</span>
    <span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">verificationUrl</span><span class="token punctuation">(</span><span class="token variable">$notifiable</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token constant">URL</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">temporarySignedRoute</span><span class="token punctuation">(</span>
            <span class="token single-quoted-string string">'register.verify'</span><span class="token punctuation">,</span>
            Carbon<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">addMinutes</span><span class="token punctuation">(</span>Config<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'auth.verification.expire'</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">[</span>
                <span class="token single-quoted-string string">'id'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$notifiable</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token single-quoted-string string">'hash'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$notifiable</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getEmailForVerification</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>As you may noticed it uses a route, let's scaffolding an verify route example as well:</p> <div class="language-php extra-class"><pre class="language-php"><code>Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'email/verify/{id}/{hash}'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'AuthController@verify'</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'register.verify'</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">middleware</span><span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token single-quoted-string string">'signed'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'throttle:6,1'</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>In a real life use case, the email content will look a bit different, because the <code>action</code> URL you want to send to the user
should match your frontend domain, not the API domain, and request to the API should be done from the frontend application.</p> <ul><li>Next let's define the controller action:</li></ul> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Request</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Response</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Binaryk<span class="token punctuation">\</span>LaravelRestify<span class="token punctuation">\</span>Services<span class="token punctuation">\</span>AuthService</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">AuthController</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
     * @var AuthService
     */</span>
    <span class="token keyword">protected</span> <span class="token variable">$authService</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span>AuthService <span class="token variable">$authService</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">authService</span> <span class="token operator">=</span> <span class="token variable">$authService</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * This will mark the email verified if the email sha1 hash and user id matches
     * 
     * @param Request $request
     * @return JsonResponse
     * @throws AuthorizationException - thrown if hash or id doesn't match
     * @throws PassportUserException - thrown if the User don't implements Passportable
     * @throws \Binaryk\LaravelRestify\Exceptions\Eloquent\EntityNotFoundException - thrown if the user not found
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">verify</span><span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">authService</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">verify</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'hash'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> Response<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'data'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$user</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>After verifying with success an <code>Illuminate\Auth\Events\Verified</code> event is dispatched.</li></ul> <h2 id="login-users-issue-token"><a href="#login-users-issue-token" class="header-anchor">#</a> Login users (issue token)</h2> <p>After having user registered and verified (if the case) the API should be able to issue personal authorization tokens.</p> <ul><li>Define a login route to an action controller:</li></ul> <div class="language-php extra-class"><pre class="language-php"><code>Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'login'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'AuthController@login'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>Inject the AuthService into your controller and call the login method:</li></ul> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Request</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Response</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Binaryk<span class="token punctuation">\</span>LaravelRestify<span class="token punctuation">\</span>Services<span class="token punctuation">\</span>AuthService</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Binaryk<span class="token punctuation">\</span>LaravelRestify<span class="token punctuation">\</span>Exceptions<span class="token punctuation">\</span>UnverifiedUser</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Binaryk<span class="token punctuation">\</span>LaravelRestify<span class="token punctuation">\</span>Exceptions<span class="token punctuation">\</span>CredentialsDoesntMatch</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Binaryk<span class="token punctuation">\</span>LaravelRestify<span class="token punctuation">\</span>Exceptions<span class="token punctuation">\</span>PassportUserException</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">AuthController</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
     * @var AuthService
     */</span>
    <span class="token keyword">protected</span> <span class="token variable">$authService</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span>AuthService <span class="token variable">$authService</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">authService</span> <span class="token operator">=</span> <span class="token variable">$authService</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/**
     * This will validate the input, 
     * will register the user and return it back to the api
     * 
     * @param Request $request
     * @return JsonResponse
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">login</span><span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token variable">$token</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">authService</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">only</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'email'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'password'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> Response<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token function">compact</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'token'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>CredentialsDoesntMatch <span class="token operator">|</span> UnverifiedUser <span class="token operator">|</span> PassportUserException <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> Response<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Something went wrong.'</span><span class="token punctuation">,</span> <span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The login method will thrown few exceptions:</p> <blockquote><p><code>Binaryk\LaravelRestify\Exceptions\CredentialsDoesntMatch</code> - when email or password doesn't match</p></blockquote> <blockquote><p><code>Binaryk\LaravelRestify\Exceptions\UnverifiedUser</code> - when <code>User</code> model implements <code>Illuminate\Contracts\Auth\MustVerifyEmail</code>
and he did not verified the email</p></blockquote> <blockquote><p><code>Binaryk\LaravelRestify\Exceptions\PassportUserException</code> - when <code>User</code> didn't implement <code>Binaryk\LaravelRestify\Contracts\Passportable</code>, the
authenticatable entity should implement this contract, this way Restify will take the control over generating tokens.</p></blockquote> <ul><li>After login with success a personal token is issued and an <code>Binaryk\LaravelRestify\Events\UserLoggedIn</code> event is dispatched.</li></ul> <h2 id="forgot-password"><a href="#forgot-password" class="header-anchor">#</a> Forgot password</h2> <p>Forgot password is the action performing by user in terms of recovering his lost password. Usually the API should send an email
with a unique URL that allow users to reset password.</p> <ul><li>Prerequisites:</li></ul> <p>If you want your users to be able to reset their passwords, make sure your <code>User</code> model implements the
<code>Illuminate\Contracts\Auth\CanResetPassword</code> contract.</p> <p>This contract requires the <code>sendPasswordResetNotification</code> to be implemented. It could looks like this:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
 * Send the password reset notification.
 *
 * @param string $token
 * @return void
 */</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">sendPasswordResetNotification</span><span class="token punctuation">(</span><span class="token variable">$token</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ResetPassword</span><span class="token punctuation">(</span><span class="token variable">$token</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Next let's define the <code>ResetPassword</code> notification. It should include a unique token, and should provide some information about the
user email. The token will be resolved by the Laravel Restify and injected into your notification, so you don't have to worry about it:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Notifications<span class="token punctuation">\</span>Messages<span class="token punctuation">\</span>MailMessage</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Notifications<span class="token punctuation">\</span>Notification</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Lang</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ResetPassword</span> <span class="token keyword">extends</span> <span class="token class-name">Notification</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
     * The password reset token.
     *
     * @var string
     */</span>
    <span class="token keyword">public</span> <span class="token variable">$token</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * The token is generated by the Restify through the Broker class
     *
     * @param string $token
     * @return void
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$token</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">token</span> <span class="token operator">=</span> <span class="token variable">$token</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Get the notification's channels.
     *
     * @param mixed $notifiable
     * @return array|string
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">via</span><span class="token punctuation">(</span><span class="token variable">$notifiable</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'mail'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Build the mail representation of the notification.
     *
     * @param mixed $notifiable
     * @return \Illuminate\Notifications\Messages\MailMessage
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">toMail</span><span class="token punctuation">(</span><span class="token variable">$notifiable</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
    
        <span class="token variable">$frontendUrl</span> <span class="token operator">=</span> <span class="token function">url</span><span class="token punctuation">(</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'app.url'</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token single-quoted-string string">'/reset-password?'</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MailMessage</span><span class="token punctuation">)</span>
            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">subject</span><span class="token punctuation">(</span>Lang<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Reset Password Notification'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">line</span><span class="token punctuation">(</span>Lang<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'You are receiving this email because we received a password reset request for your account.'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">action</span><span class="token punctuation">(</span>Lang<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Reset Password'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$frontendUrl</span> <span class="token punctuation">.</span> <span class="token function">http_build_query</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'token'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">token</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'email'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$notifiable</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getEmailForPasswordReset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">line</span><span class="token punctuation">(</span>Lang<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'This password reset link will expire in :count minutes.'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'count'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">config</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'auth.passwords.'</span> <span class="token punctuation">.</span> <span class="token function">config</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'auth.defaults.passwords'</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token single-quoted-string string">'.expire'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">line</span><span class="token punctuation">(</span>Lang<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'If you did not request a password reset, no further action is required.'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>The <code>getEmailForPasswordReset</code> method simply returns the user email:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
 * @inheritDoc
 */</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getEmailForPasswordReset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">email</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>Define a forgot password route to an action controller:</li></ul> <div class="language-php extra-class"><pre class="language-php"><code>Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'password/email'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'AuthController@sendResetLinkEmail'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>Inject the AuthService into your controller and call the <code>sendResetPasswordLinkEmail</code> method:</li></ul> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Binaryk<span class="token punctuation">\</span>LaravelRestify<span class="token punctuation">\</span>Exceptions<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>EntityNotFoundException</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Binaryk<span class="token punctuation">\</span>LaravelRestify<span class="token punctuation">\</span>Exceptions<span class="token punctuation">\</span>PasswordResetException</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Request</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Response</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Binaryk<span class="token punctuation">\</span>LaravelRestify<span class="token punctuation">\</span>Services<span class="token punctuation">\</span>AuthService</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Validation<span class="token punctuation">\</span>ValidationException</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">AuthController</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
     * @var AuthService
     */</span>
    <span class="token keyword">protected</span> <span class="token variable">$authService</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span>AuthService <span class="token variable">$authService</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">authService</span> <span class="token operator">=</span> <span class="token variable">$authService</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

     <span class="token comment">/**
      * This will validate the request input (email exists for example) and will send an reset passw
      * 
      * @param Request $request
      * @return JsonResponse
      */</span>
     <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">sendResetLinkEmail</span><span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
         <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">authService</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">sendResetPasswordLinkEmail</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'email'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
         <span class="token keyword">return</span> Response<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token single-quoted-string string">''</span><span class="token punctuation">,</span> <span class="token number">204</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>EntityNotFoundException <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Defined in the configuration auth.providers.users.model could not been instantiated (may be abstract or missing at all)</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>PasswordResetException <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Something unexpected from the Broker class</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>ValidationException <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// The email is not valid</span>
        <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
</code></pre></div><h2 id="reset-password"><a href="#reset-password" class="header-anchor">#</a> Reset password</h2> <p>Finally we have to reset the users passwords. This can easily be done by using Restify AuthService as well.</p> <ul><li>Define a reset password route to an action controller:</li></ul> <div class="language-php extra-class"><pre class="language-php"><code>Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'password/reset'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'AuthController@resetPassword'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'password.reset'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>Inject the AuthService into your controller and call the resetPassword method:</li></ul> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Request</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Response</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Binaryk<span class="token punctuation">\</span>LaravelRestify<span class="token punctuation">\</span>Services<span class="token punctuation">\</span>AuthService</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">AuthController</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
     * @var AuthService
     */</span>
    <span class="token keyword">protected</span> <span class="token variable">$authService</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span>AuthService <span class="token variable">$authService</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">authService</span> <span class="token operator">=</span> <span class="token variable">$authService</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

   <span class="token comment">/**
    * @param Request $request
    * @return JsonResponse
    * @throws \Binaryk\LaravelRestify\Exceptions\Eloquent\EntityNotFoundException
    * @throws \Illuminate\Contracts\Container\BindingResolutionException
    * @throws \Illuminate\Validation\ValidationException
    */</span>
   <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">resetPassword</span><span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">)</span>
   <span class="token punctuation">{</span>
       <span class="token keyword">try</span> <span class="token punctuation">{</span>
           <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">authService</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">resetPassword</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

           <span class="token keyword">return</span> Response<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token function">__</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Password reset'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>PasswordResetException<span class="token operator">|</span>PasswordResetInvalidTokenException <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">return</span> Response<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Something went wrong'</span><span class="token punctuation">,</span> <span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

</code></pre></div><p>After successfully password reset an <code>Illuminate\Auth\Events\PasswordReset</code> event is dispatched.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/laravel-restify/docs/1.0/search/search.html" class="prev">Filtering entities</a></span> <span class="next"><a href="/laravel-restify/docs/1.0/exception-handler/exception-handler.html">Restify Exception Handler</a>
      →
    </span></p></div> </main></div><div class="global-ui"><SWUpdatePopup></SWUpdatePopup></div></div>
    <script src="/laravel-restify/assets/js/app.9f7e32d5.js" defer></script><script src="/laravel-restify/assets/js/2.c48f6ac5.js" defer></script><script src="/laravel-restify/assets/js/7.eff9fbd6.js" defer></script>
  </body>
</html>
